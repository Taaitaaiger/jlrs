name: Bindgen

on:
  workflow_dispatch:

jobs:
  bindgen-macos-1-6:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Julia environment
        uses: julia-actions/setup-julia@v1
        with:
          version: '1.6'

      - name: Setup Rust
        uses:  dtolnay/rust-toolchain@master
        with:
          toolchain: stable

      - name: Generate bindings
        run: |
          export JULIA_DIR="$(dirname $(dirname $(which julia)))"
          export LD_LIBRARY_PATH="${JULIA_DIR}/lib:${JULIA_DIR}/lib/julia:${LD_LIBRARY_PATH}"
          cd jl_sys
          cargo build --features use-bindgen,julia-1-6 --verbose
          cat ../target/debug/build/jl-sys*/out/bindings.rs

  bindgen-macos-1-7:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Julia environment
        uses: julia-actions/setup-julia@v1
        with:
          version: '1.7'

      - name: Setup Rust
        uses:  dtolnay/rust-toolchain@master
        with:
          toolchain: stable

      - name: Generate bindings
        run: |
          export JULIA_DIR="$(dirname $(dirname $(which julia)))"
          export LD_LIBRARY_PATH="${JULIA_DIR}/lib:${JULIA_DIR}/lib/julia:${LD_LIBRARY_PATH}"
          cd jl_sys
          cargo build --features use-bindgen,julia-1-7 --verbose
          cat ../target/debug/build/jl-sys*/out/bindings.rs

  bindgen-macos-1-8:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Julia environment
        uses: julia-actions/setup-julia@v1
        with:
          version: '1.8'

      - name: Setup Rust
        uses:  dtolnay/rust-toolchain@master
        with:
          toolchain: stable

      - name: Generate bindings
        run: |
          export JULIA_DIR="$(dirname $(dirname $(which julia)))"
          export LD_LIBRARY_PATH="${JULIA_DIR}/lib:${JULIA_DIR}/lib/julia:${LD_LIBRARY_PATH}"
          cd jl_sys
          cargo build --features use-bindgen,julia-1-8 --verbose
          cat ../target/debug/build/jl-sys*/out/bindings.rs

  bindgen-macos-1-9:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Julia environment
        uses: julia-actions/setup-julia@v1
        with:
          version: '1.9-nightly'

      - name: Setup Rust
        uses:  dtolnay/rust-toolchain@master
        with:
          toolchain: stable

      - name: Generate bindings
        run: |
          export JULIA_DIR="$(dirname $(dirname $(which julia)))"
          export LD_LIBRARY_PATH="${JULIA_DIR}/lib:${JULIA_DIR}/lib/julia:${LD_LIBRARY_PATH}"
          cd jl_sys
          cargo build --features use-bindgen,julia-1-9 --verbose
          cat ../target/debug/build/jl-sys*/out/bindings.rs
